(function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}};b=require("crypto"),c=require("request-promise-native"),a=function(){function a(a,c){var e;this.clientSecret=a,this.env=null!=c?c:"prod",this._merkleMix=d(this._merkleMix,this),this._checkSiblings=d(this._checkSiblings,this),this.prove=d(this.prove,this),this._req=d(this._req,this),this._post=d(this._post,this),this._get=d(this._get,this),this.stamp=d(this.stamp,this),this.getAll=d(this.getAll,this),this.getByHash=d(this.getByHash,this),this.getById=d(this.getById,this),this.clientId=b.createHash("md5").update(this.clientSecret).digest("hex").substring(0,15),e=new Buffer(this.clientId+":"+this.clientSecret),this.auth="Basic "+e.toString("base64"),this.host="beta"===this.env?"https://api-beta.stampery.com":"https://api-prod.stampery.com"}return a.prototype.hash=function(a){return b.createHash("sha256").update(a).digest()},a.prototype.getById=function(a){return this._get("stamps/"+a)},a.prototype.getByHash=function(a){return a instanceof Buffer&&(a=a.toString("hex")),this._get("stamps/"+a)},a.prototype.getAll=function(a,b){var c,d;return d=null!=b?[a,b]:[0,a],c=d[0],a=d[1],this._get("stamps?page="+c,a)},a.prototype.stamp=function(a,b){var c;return null==b&&(b=null),a instanceof Buffer&&(a=a.toString("hex")),c={hash:a},b&&(c.hook=b),this._post("stamps",c)},a.prototype._get=function(a){return this._req("GET",a,{})},a.prototype._post=function(a,b){return this._req("POST",a,b)},a.prototype._req=function(a,b,d){var e;return e={method:a,uri:this.host+"/"+b,headers:{Authorization:this.auth,"Content-Type":"application/json"},json:!0},d&&(e.json=d),new Promise(function(a,b){return c(e).then(function(b){return a(b.result)}).catch(function(a){return b(a)})})},a.prototype.prove=function(a){var b;return"receipts"in a&&(a=a.receipts),"btc"in a&&(a=[a.btc,a.eth].find(function(a){return"number"!=typeof a})),!!a&&(b=Buffer(a.targetHash,"hex"),this._checkSiblings(b,a.proof,a.merkleRoot))},a.prototype._checkSiblings=function(a,b,c){var d,e,f,g;return b.length>0?(e=b[0],g=b.slice(1),d="left"in e?[e.left,a]:[a,e.right],f=this._merkleMix(d),this._checkSiblings(f,g,c)):(c=new Buffer(c,"hex"),c.equals(a))},a.prototype._merkleMix=function(a){var b;return b=Buffer.concat(a.map(function(a){return Buffer(a,"hex")})),this.hash(b)},a}(),module.exports=a}).call(this);